package com.example.monprofil

import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import com.squareup.moshi.JsonAdapter
import com.squareup.moshi.Moshi
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.launch
import retrofit2.Retrofit
import retrofit2.converter.moshi.MoshiConverterFactory

class MainViewModel : ViewModel() {
    val movies = MutableStateFlow<List<ModelFilm>>(listOf())
    /*val tv = MutableStateFlow<List<ModelSerie>>(listOf())
    val creditMovie = MutableStateFlow<List<ModelCastFilm>>(listOf())
    val creditSerie = MutableStateFlow<List<ModelCastSerie>>(listOf())
    val actor = MutableStateFlow<List<ModelDateNaissance>>(listOf())*/

    val api_key = "b7a6cf89c9ecb4eb6d5e4d8849cc4d0d"
    val language = "fr-FR"

    val retrofit = Retrofit.Builder()
        .baseUrl("https://api.themoviedb.org/3/")
        .addConverterFactory(MoshiConverterFactory.create())
        .build();

    val service = retrofit.create(TmdbAPI::class.java)

    fun getFilmsInitiaux() {
        viewModelScope.launch {
            movies.value = service.GetDerniersFilms(api_key, language).results
        }
    }

    /*val moshi : Moshi = Moshi.Builder().build();
    val jsonAdapter : JsonAdapter<ModelDerniersFilms> = moshi.adapter(ModelDerniersFilms::class.java);
    val jsonResult = "{\"page\":1,\"results\":[{\"adult\":false,\"backdrop_path\":\"/jsoz1HlxczSuTx0mDl2h0lxy36l.jpg\",\"id\":616037,\"title\":\"Thor : Love and Thunder\",\"original_language\":\"en\",\"original_title\":\"Thor: Love and Thunder\",\"overview\":\"Alors que Thor est en pleine introspection et en quête de sérénité, sa retraite est interrompue par un tueur galactique connu sous le nom de Gorr, qui s’est donné pour mission d’exterminer tous les dieux. Pour affronter cette menace, Thor demande l’aide de Valkyrie, de Korg et de son ex-petite amie Jane Foster, qui, à sa grande surprise, manie inexplicablement son puissant marteau, le Mjolnir. Ensemble, ils se lancent dans une dangereuse aventure cosmique pour comprendre les motivations qui poussent Gorr à la vengeance et l’arrêter avant qu’il ne soit trop tard.\",\"poster_path\":\"/kSMarEm3ESOOr11dzsep2RZ1ClD.jpg\",\"media_type\":\"movie\",\"genre_ids\":[14,28,35],\"popularity\":3196.382,\"release_date\":\"2022-07-06\",\"video\":false,\"vote_average\":6.777,\"vote_count\":3733},{\"adult\":false,\"backdrop_path\":\"/odJ4hx6g6vBt4lBWKFD1tI8WS4x.jpg\",\"id\":361743,\"title\":\"Top Gun: Maverick\",\"original_language\":\"en\",\"original_title\":\"Top Gun: Maverick\",\"overview\":\"Après avoir été l’un des meilleurs pilotes de chasse de l'Aéronavale américaine pendant plus de trente ans, Pete “Maverick\\\" Mitchell continue à repousser ses limites en tant que pilote d'essai. Il refuse de monter en grade, car cela l’obligerait à renoncer à voler. Il est chargé de former un détachement de jeunes diplômés de l’école Top Gun pour une mission spéciale qu’aucun pilote n'aurait jamais imaginée. Lors de cette mission, Maverick rencontre le lieutenant Bradley “Rooster” Bradshaw, le fils de son défunt ami, le navigateur Nick “Goose” Bradshaw. Face à un avenir incertain, hanté par ses fantômes, Maverick va devoir affronter ses pires cauchemars au cours d’une mission qui exigera les plus grands sacrifices.\",\"poster_path\":\"/kTh1s6I6yUyk2OGiRoGkDTYTS6K.jpg\",\"media_type\":\"movie\",\"genre_ids\":[28,18],\"popularity\":2183.187,\"release_date\":\"2022-05-24\",\"video\":false,\"vote_average\":8.359,\"vote_count\":3956},{\"adult\":false,\"backdrop_path\":\"/nnUQqlVZeEGuCRx8SaoCU4XVHJN.jpg\",\"id\":532639,\"title\":\"Pinocchio\",\"original_language\":\"en\",\"original_title\":\"Pinocchio\",\"overview\":\"La célèbre histoire de ce pantin de bois, Pinocchio, bien décidé à vivre la plus palpitante des aventures pour devenir un vrai petit garçon.\",\"poster_path\":\"/nch8NTH45TBH4JyPuugttPzoxau.jpg\",\"media_type\":\"movie\",\"genre_ids\":[14,12,10751],\"popularity\":6040.248,\"release_date\":\"2022-09-07\",\"video\":false,\"vote_average\":6.767,\"vote_count\":698},{\"adult\":false,\"backdrop_path\":\"/doKogHyd0BFlEwQClE3B0opnbdN.jpg\",\"id\":429473,\"title\":\"Lou\",\"original_language\":\"en\",\"original_title\":\"Lou\",\"overview\":\"Une jeune femme et son propriétaire font équipe pour retrouver l'enfant de la première après que la fille a été kidnappée par l'ex-mari de la femme.\",\"poster_path\":\"/djM2s4wSaATn4jVB33cV05PEbV7.jpg\",\"media_type\":\"movie\",\"genre_ids\":[28,53],\"popularity\":142.388,\"release_date\":\"2022-09-23\",\"video\":false,\"vote_average\":6.3,\"vote_count\":65},{\"adult\":false,\"backdrop_path\":\"/geYUecpFI2AonDLhjyK9zoVFcMv.jpg\",\"id\":810693,\"title\":\"Jujutsu Kaisen 0\",\"original_language\":\"ja\",\"original_title\":\"劇場版 呪術廻戦 0\",\"overview\":\"Lorsqu'ils étaient enfants, Rika Orimoto a perdu la vie dans un accident sous les yeux d’un ami proche, Yuta Okkotsu. « On va se faire une promesse. Quand on sera grands, toi et moi, on se mariera. » Depuis, Rika vient hanter Yuta qui a même souhaité sa propre mort après avoir souffert des années de cette malédiction. Jusqu’au jour où le plus puissant des exorcistes, Satoru Gojo, l'a accueilli dans l'école d'exorcisme.\",\"poster_path\":\"/jW4OW6ySAtP40BzUWgVmsApqyaS.jpg\",\"media_type\":\"movie\",\"genre_ids\":[16,28,14],\"popularity\":2543.959,\"release_date\":\"2021-12-24\",\"video\":false,\"vote_average\":8.225,\"vote_count\":452},{\"adult\":false,\"backdrop_path\":\"/2k9tBql5GYH328Krj66tDT9LtFZ.jpg\",\"id\":760741,\"title\":\"Beast\",\"original_language\":\"en\",\"original_title\":\"Beast\",\"overview\":\"Le Dr. Nate Daniels, revient en Afrique du Sud, où il a autrefois rencontré sa femme aujourd’hui décédée, pour y passer des vacances prévues de longue date avec ses deux filles dans une réserve naturelle, tenue par Martin Battles, un vieil ami de la famille, biologiste spécialiste de la vie sauvage. Mais ce repos salvateur va se transformer en épreuve de survie quand un lion assoiffé de vengeance, unique rescapé de la traque sanguinaire d’ignobles braconniers, se met à dévorer tout humain sur sa route et prend en chasse le docteur et sa famille.\",\"poster_path\":\"/kmWpbWYu4gT7wIV4amP0gMDjNHj.jpg\",\"media_type\":\"movie\",\"genre_ids\":[12,18,27],\"popularity\":4814.824,\"release_date\":\"2022-08-11\",\"video\":false,\"vote_average\":7.12,\"vote_count\":467},{\"adult\":false,\"backdrop_path\":\"/mKyGisiT2ZrfKC9Bb7yK9lO7T8q.jpg\",\"id\":556694,\"title\":\"Trois mille ans à t'attendre\",\"original_language\":\"en\",\"original_title\":\"Three Thousand Years of Longing\",\"overview\":\"Alithea Binnie, bien que satisfaite par sa vie, porte un regard sceptique sur le monde. Un jour, elle rencontre un génie qui lui propose d’exaucer trois vœux en échange de sa liberté.  Mais Alithea est bien trop érudite pour ignorer que, dans les contes, les histoires de vœux se terminent mal.  Il plaide alors sa cause en lui racontant son passé extraordinaire. Séduite par ses récits, elle finit par formuler un vœu des plus surprenants.\",\"poster_path\":\"/qSL8lregjkzWucEdatzpiwvLLIn.jpg\",\"media_type\":\"movie\",\"genre_ids\":[14,18,10749],\"popularity\":219.502,\"release_date\":\"2022-08-24\",\"video\":false,\"vote_average\":6.936,\"vote_count\":259},{\"adult\":false,\"backdrop_path\":\"/ghsPsvM0sEztdNT4kUlTsBF2LEF.jpg\",\"id\":852046,\"title\":\"Athena\",\"original_language\":\"fr\",\"original_title\":\"Athena\",\"overview\":\"La mort tragique de leur frère cadet dans des circonstances troubles, va en quelques heures faire basculer la vie d'une fratrie dans le chaos.\",\"poster_path\":\"/66hefmZ1ZVLO1Hb57sZVGSlDAmM.jpg\",\"media_type\":\"movie\",\"genre_ids\":[18,28,53],\"popularity\":36.805,\"release_date\":\"2022-09-09\",\"video\":false,\"vote_average\":6.488,\"vote_count\":80},{\"adult\":false,\"backdrop_path\":\"/yWRvAfZmbzk61REYod4WQACDhRj.jpg\",\"id\":762968,\"title\":\"Si tu me venges…\",\"original_language\":\"en\",\"original_title\":\"Do Revenge\",\"overview\":\"Dans un très chic établissement privé, une reine du lycée déchue passe un accord secret avec une nouvelle élève sans histoires pour se venger de leurs ennemis respectifs.\",\"poster_path\":\"/roPy2yunkSRA02C1oYiwr8QgHIL.jpg\",\"media_type\":\"movie\",\"genre_ids\":[35],\"popularity\":1102.242,\"release_date\":\"2022-09-14\",\"video\":false,\"vote_average\":6.972,\"vote_count\":251},{\"adult\":false,\"backdrop_path\":\"/aCaqCvYn48b3lfGKGnUdVAE1yeB.jpg\",\"id\":814800,\"title\":\"Goodnight Mommy\",\"original_language\":\"en\",\"original_title\":\"Goodnight Mommy\",\"overview\":\"Deux frères jumeaux arrivent dans la maison de campagne de leur mère et la découvrent le visage couvert de bandages - conséquence, selon elle, d'une opération de chirurgie esthétique. Alors que son comportement devient de plus en plus bizarre, une idée effrayante grandit peu à peu dans l'esprit des deux garçons : peut-être que la femme sous ces bandages n'est pas leur mère.\",\"poster_path\":\"/oHhD5jD4S5ElPNNFCDKXJAzMZ5h.jpg\",\"media_type\":\"movie\",\"genre_ids\":[27,18,53],\"popularity\":744.953,\"release_date\":\"2022-09-16\",\"video\":false,\"vote_average\":6.191,\"vote_count\":102},{\"adult\":false,\"backdrop_path\":\"/2RSirqZG949GuRwN38MYCIGG4Od.jpg\",\"id\":985939,\"title\":\"Fall\",\"original_language\":\"en\",\"original_title\":\"Fall\",\"overview\":\"Pour les meilleurs amis Becky et Hunter, la vie consiste à vaincre ses peurs et à repousser ses limites. Mais après avoir grimpé à 2 000 pieds au sommet d'une tour de radio isolée et abandonnée, elles se retrouvent bloquées sans aucun moyen de descendre. Maintenant, les compétences expertes en escalade de Becky et Hunter seront mises à l'épreuve ultime alors qu'elle se battent désespérément pour survivre aux éléments, au manque de fournitures et aux hauteurs vertigineuses.\",\"poster_path\":\"/spCAxD99U1A6jsiePFoqdEcY0dG.jpg\",\"media_type\":\"movie\",\"genre_ids\":[53],\"popularity\":8806.711,\"release_date\":\"2022-08-11\",\"video\":false,\"vote_average\":7.448,\"vote_count\":969},{\"adult\":false,\"backdrop_path\":\"/nmGWzTLMXy9x7mKd8NKPLmHtWGa.jpg\",\"id\":438148,\"title\":\"Les Minions 2 : Il était une fois Gru\",\"original_language\":\"en\",\"original_title\":\"Minions: The Rise of Gru\",\"overview\":\"Alors que les années 70 battent leur plein, Gru qui grandit en banlieue au milieu des jeans à pattes d’éléphants et des chevelures en fleur, met sur pied un plan machiavélique à souhait pour réussir à intégrer un groupe célèbre de super méchants, connu sous le nom de Vicious 6, dont il est le plus grand fan. Il est secondé dans sa tâche par les Minions, ses petits compagnons aussi turbulents que fidèles. Avec l’aide de Kevin, Stuart, Bob et Otto – un nouveau Minion arborant un magnifique appareil dentaire et un besoin désespéré de plaire - ils vont déployer ensemble des trésors d’ingéniosité afin de construire leur premier repaire, expérimenter leurs premières armes, et lancer leur première mission. Lorsque les Vicious 6 limogent leur chef, le légendaire \\\" Wild Knuckles \\\", Gru passe l’audition pour intégrer l’équipe. Le moins qu’on puisse dire c’est que l’entrevue tourne mal, et soudain court quand Gru leur démontre sa supériorité et se retrouve soudain leur ennemi juré.\",\"poster_path\":\"/ucLdEGaIFlpIdGlkzYj2OcXbGhz.jpg\",\"media_type\":\"movie\",\"genre_ids\":[16,12,35,14],\"popularity\":2011.333,\"release_date\":\"2022-06-29\",\"video\":false,\"vote_average\":7.602,\"vote_count\":2031},{\"adult\":false,\"backdrop_path\":\"/xVbppM1xgbskOKgOuV8fbWBWHtt.jpg\",\"id\":762504,\"title\":\"Nope\",\"original_language\":\"en\",\"original_title\":\"Nope\",\"overview\":\"Les habitants d’une vallée perdue du fin fond de la Californie sont témoins d’une découverte terrifiante à caractère surnaturel.\",\"poster_path\":\"/b1z84OMbtzmFWsiQWyonoPqWY2Z.jpg\",\"media_type\":\"movie\",\"genre_ids\":[27,9648,878,53],\"popularity\":1393.374,\"release_date\":\"2022-07-20\",\"video\":false,\"vote_average\":7.01,\"vote_count\":1577},{\"adult\":false,\"backdrop_path\":\"/rwgmDkIEv8VjAsWx25ottJrFvpO.jpg\",\"id\":744276,\"title\":\"After : Chapitre 4\",\"original_language\":\"en\",\"original_title\":\"After Ever Happy\",\"overview\":\"Le quatrième et dernier volet des aventures de Tessa et Hardin.  Une révélation sur le passé de Tessa ébranle le couple qu'elle forme avec Hardin. Parallèlement, une vérité choquante sur leur famille respective surgit. Les deux amants ne sont pas si différents l'un de l'autre. Tessa n'est plus la gentille fille qu'elle était lorsqu'elle a rencontré Hardin, lui, n'est plus que le garçon lunatique dont elle est tombée amoureuse.\",\"poster_path\":\"/zqd0c9uJQ5mjJvieiRN4VkpJzTs.jpg\",\"media_type\":\"movie\",\"genre_ids\":[10749,18],\"popularity\":1424.243,\"release_date\":\"2022-08-24\",\"video\":false,\"vote_average\":6.5,\"vote_count\":84},{\"adult\":false,\"backdrop_path\":\"/9hk5iiycq7ukRAAXQiJT9HZX3SX.jpg\",\"id\":507086,\"title\":\"Jurassic World : Le Monde d’après\",\"original_language\":\"en\",\"original_title\":\"Jurassic World Dominion\",\"overview\":\"Quatre ans après la destruction de Isla Nublar. Les dinosaures font désormais partie du quotidien de l’humanité entière. Un équilibre fragile qui va remettre en question la domination de l’espèce humaine maintenant qu’elle doit partager son espace avec les créatures les plus féroces que l’histoire ait jamais connues.\",\"poster_path\":\"/eVY9MIFVTcgWi2OzevfXuEjKlrR.jpg\",\"media_type\":\"movie\",\"genre_ids\":[12,28,878],\"popularity\":2243.433,\"release_date\":\"2022-06-01\",\"video\":false,\"vote_average\":7.051,\"vote_count\":3451},{\"adult\":false,\"backdrop_path\":\"/yo0qfH2dQGGMxkfivdkz5zxVatD.jpg\",\"id\":830788,\"title\":\"Le Bal de l'Enfer\",\"original_language\":\"en\",\"original_title\":\"The Invitation\",\"overview\":\"Après la mort de sa mère, Evie se retrouve sans famille. Elle décide de faire un test ADN et se découvre un cousin éloigné dont elle ne soupçonnait pas l'existence. Après être entrée en contact avec lui, il l'invite à un somptueux mariage dans la campagne anglaise afin qu'elle rencontre sa nouvelle famille. D'abord sous le charme du séduisant aristocrate qui accueille les festivités, elle se retrouve rapidement plongée dans une lutte infernale pour sa survie en découvrant les sombres secrets de l'histoire de sa famille et les intentions troublantes de ses hôtes sous couvert d'une étrange générosité.\",\"poster_path\":\"/kuHvnvP5zBkazEuI3WcuanDd83D.jpg\",\"media_type\":\"movie\",\"genre_ids\":[27,53],\"popularity\":185.917,\"release_date\":\"2022-08-24\",\"video\":false,\"vote_average\":6.357,\"vote_count\":119},{\"adult\":false,\"backdrop_path\":\"/7Y3LdmsZukXhmwxtO0UF95BFBTt.jpg\",\"id\":682507,\"title\":\"Là où chantent les écrevisses\",\"original_language\":\"en\",\"original_title\":\"Where the Crawdads Sing\",\"overview\":\"Kya, une petite fille abandonnée, a grandi seule dans les dangereux marécages de Caroline du Nord. Pendant des années, les rumeurs les plus folles ont couru sur la \\\"Fille des Marais\\\" de Barkley Cove, isolant encore davantage la sensible et résiliente Kya de la communauté. Sa rencontre avec deux jeunes hommes de la ville lui ouvre un monde nouveau et effrayant ; mais lorsque l'un d'eux est retrouvé mort, toute la communauté la considère immédiatement comme la principale suspecte. A mesure que la vérité sur les événements se dessine, les réponses menacent de révéler les nombreux secrets enfouis dans les marécages.\",\"poster_path\":\"/leM2Krf87zKSNvT98kpFC2xC7rI.jpg\",\"media_type\":\"movie\",\"genre_ids\":[18,9648,53],\"popularity\":493.926,\"release_date\":\"2022-07-15\",\"video\":false,\"vote_average\":7.8,\"vote_count\":378},{\"adult\":false,\"backdrop_path\":\"/8d4gNr2WoW8U2AlRMUSrcBxWXNd.jpg\",\"id\":916605,\"title\":\"The Infernal Machine\",\"original_language\":\"en\",\"original_title\":\"The Infernal Machine\",\"overview\":\"Bruce Cogburn, un auteur reclus et controversé, est extirpé de sa cachette quand il reçoit des lettres interminables d'un fan obsessionnel. Il est alors plongé dans un labyrinthe dangereux en cherchant l'auteur de ces messages énigmatiques.\",\"poster_path\":\"/bSqpOGzaKBdGkBLmcm1JJIVryYy.jpg\",\"media_type\":\"movie\",\"genre_ids\":[53],\"popularity\":84.181,\"release_date\":\"2022-09-23\",\"video\":false,\"vote_average\":6.0,\"vote_count\":13},{\"adult\":false,\"backdrop_path\":\"/Yc9q6QuWrMp9nuDm5R8ExNqbEq.jpg\",\"id\":19995,\"title\":\"Avatar\",\"original_language\":\"en\",\"original_title\":\"Avatar\",\"overview\":\"Un marine paraplégique envoyé sur la lune Pandora pour une mission unique est tiraillé entre suivre ses ordres et protéger le monde qu'il considère le sien.\",\"poster_path\":\"/3npygfmEhqnmNTmDWhHLz1LPcbA.jpg\",\"media_type\":\"movie\",\"genre_ids\":[28,12,14,878],\"popularity\":2010.837,\"release_date\":\"2009-12-10\",\"video\":false,\"vote_average\":7.52,\"vote_count\":26138},{\"adult\":false,\"backdrop_path\":\"/14QbnygCuTO0vl7CAFmPf1fgZfV.jpg\",\"id\":634649,\"title\":\"Spider-Man: No Way Home\",\"original_language\":\"en\",\"original_title\":\"Spider-Man: No Way Home\",\"overview\":\"Après les événements liés à l'affrontement avec Mysterio, l'identité secrète de Spider-Man a été révélée. Il est poursuivi par le gouvernement américain, qui l'accuse du meurtre de Mysterio, et traqué par les médias. Cet événement a également des conséquences terribles sur la vie de sa petite-amie M.J. et de son meilleur ami Ned. Désemparé, Peter Parker demande alors de l'aide au docteur Strange. Ce dernier lance un sort pour que tout le monde oublie que Peter est Spider-Man. Mais les choses ne se passent pas comme prévu, et cette action altère la stabilité de l'espace-temps. Cela ouvre le « multivers », un concept terrifiant dont ils ne savent quasiment rien...\",\"poster_path\":\"/3SyG7dq2q0ollxJ4pSsrqcfRmVj.jpg\",\"media_type\":\"movie\",\"genre_ids\":[28,12,878],\"popularity\":1341.293,\"release_date\":\"2021-12-15\",\"video\":false,\"vote_average\":8.038,\"vote_count\":15220}],\"total_pages\":1000,\"total_results\":20000}";
    fun getFilmsInitiaux() {
        viewModelScope.launch {
            val res = jsonAdapter.fromJson(jsonResult)?.results
            if(res != null){
                movies.value = res;
            }
        }
    }*/

    /*fun getSeriesInitiaux() {
        viewModelScope.launch {
            tv.value = service.GetDernieresSeries(api_key, language).results
        }
    }*/

    /*fun DistributionFilm(){
        viewModelScope.launch {
            creditMovie.value = service.GetDistributionFilm(idFilm, api_key, language).results
        }
    }*/

    /*fun DistributionSerie(){
        viewModelScope.launch {
            creditSeries.value = service.GetDistributionSerie(idSerie, api_key, language).results
        }
    }*/

    /*fun Acteur(){
        viewModelScope.launch {
            actor.value = service.DateNaissance(idActeur, api_key, language).results
        }
    }*/
}